<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MediaDevices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
</head>
<body>
  <!--video用于显示媒体设备的视频流，自动播放-->
  <video id="video" autoplay style="width: 240px;height: 320px"></video>
  <!--按钮-->
  <div style="display: flex;">
    <div>
      <div><button id="capture1">拍照</button></div>
      <canvas id="canvas1" width="240" height="320" style="width: 240px;height: 320px"></canvas>
    </div>
    <div>
      <div><button id="capture2">摄像</button></div>
      <canvas id="canvas2" width="240" height="320" style="width: 240px;height: 320px"></canvas>
    </div>
  </div>

  <a download='snap.png' id="download">下载图片</a>

  <script>
    let video = document.getElementById("video");
    let canvas1 = document.getElementById("canvas1");
    let context1 = canvas1.getContext("2d");
    let canvas2 = document.getElementById("canvas2");
    let context2 = canvas2.getContext("2d");

    //访问用户媒体设备的兼容方法
    let mediaDevices = navigator.mediaDevices || navigator.webkitGetUserMedia;
    if (mediaDevices) {
      mediaDevices.getUserMedia({ audio: true, video: true })
        .then(stream => {
          //兼容webkit内核浏览器
          let url = window.URL || window.webkitURL;
          //将视频流设置为video元素的源
          video.src = url.createObjectURL(stream);
          //播放视频
          video.play();
        })
        .catch(error => {
          console.log("访问用户媒体设备失败：",error.name,error.message);
        });
    } else {
      alert("你的浏览器不支持访问用户媒体设备");
    }

    // 拍照
    document.getElementById("capture1").addEventListener("click",function(){
      context1.drawImage(video,0,0,240,320);
      // 设置下载图片的数据
      document.getElementById('download').href = canvas1.toDataURL('image/png');
    });

    // 摄像模拟 (canvas定时截取)
    document.getElementById("capture2").addEventListener("click",function(){
      setInterval(() => {
        context2.drawImage(video,0,0,240,320);
      }, 10);
    });


  </script>
</body>
</html>
